<!doctype html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="./css/concise.min.css">
		<link rel="stylesheet" href="./css/concise-ui.min.css">
		<link rel="stylesheet" href="./css/concise-utils.min.css">
		
		<link rel="stylesheet" href="./css/style.css">
		<link rel="stylesheet" href="./css/hubfont.css">
				
		<script src="./js/gl-matrix-min.js"></script>
		<script src="./js/phoria-min.js"></script>
		<script src="./js/trilateration.js"></script>
		
		<script src="./js/zepto.min.js"></script>
		<script src="./js/mustache.min.js"></script>
		<script src="./js/metadata.js"></script>
		<script src="./js/rdl.js"></script>
		<script src="./js/hgrid.js"></script>
		
		<title>NMS The HUB: Management System</title>
	</head>
	
	<body>

		<script type="text/javascript">
			var requestAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame ||
                       window.mozRequestAnimationFrame || window.msRequestAnimationFrame || 
                       function(c) {window.setTimeout(c, 250)};

			// bind to window onload event
			window.addEventListener('load', onloadHandler, false);

			function onloadHandler(){
			
				phoriaHandler.initialize("canvas","canvasParent");
				regionHandler.initialize();
				
				uiHandler.initialize("#listSearchKey");	
				loadMetaData();
				uiHandler.updateSystemGrid();
			
				var pause = false;
				var fnAnimate = function() {
				  if (!pause){
					 phoriaHandler.scene.modelView();
					 phoriaHandler.renderer.render(phoriaHandler.scene);
				  }
				  requestAnimFrame(fnAnimate);
				};

				// key binding
				document.addEventListener('keydown', function(e) {
					switch (e.keyCode){
						case 27: // ESC
							pause = !pause;
						break;
						case 87: // W
						//phoriaHandler.camera.position.z-=10;
							phoriaHandler.rotateCamYZ(true);
						break;
						case 83: // S
						// move back along current heading
						//fnPositionLookAt(vec3.fromValues(0,0,-1), heading, lookAt);
							phoriaHandler.rotateCamYZ(false);
						break;	

						case 65: // A
							phoriaHandler.rotateCamXZ(true);
						break;
						
						case 68: // D
							phoriaHandler.rotateCamXZ(false);
						break;
						
						case 81: // Q
							phoriaHandler.doZoom(true);
						break;

						case 69: // E
							phoriaHandler.doZoom(false);
						break;
						
						case 38: // Arrow up
							phoriaHandler.doUpDownCamera(true);
						break;
						
						case 40: // Arrow down
							phoriaHandler.doUpDownCamera(false);
						break;
						
						default:
							console.log(e.keyCode);
						break;
					}
					
					phoriaHandler.renderFrame();
					
				}, false);

				// THIS IS filter
				var htmlForSelection = 
					Mustache.render(
					$("#selectstartemplate").html(), {data:  regionHandler.stars.sort(gridHandler.dynamicSort("solarIndexId"))});
					$("#distanceASelected").html(htmlForSelection);	
					$("#distanceBSelected").html(htmlForSelection);	
			
			}

		</script>
	
		<div container style="max-width:inherit!important;">

			<div grid>
				
				<div column="4" id="leftpanel">
				
					<div id="brand">NMS The Hub Management system  <span class="tag-box -success">v.0.1</span></div>
					
					<section id="mainsectionblock" class="alert-box">

						<section grid="no-collapse">
							<div column  onclick="uiHandler.showList();">
								<button class="sectionbtn -success"><i class="icon-target"></i> System selection</button>
							</div>
							<div column  onclick="uiHandler.showMaterials();">
								<button class="sectionbtn -success"><i class="icon-chart-line"></i> Materials list</button>
							</div>
							<div column  onclick="uiHandler.showFind();">
								<button class="sectionbtn -success"><i class="icon-search"></i> System sharing</button>
							</div>
							
						</section>
						
						<div id="tableContainer">
							<div id="listGridContainer">
								<div class="paneltitle">System sharing</div>
								
								<div>Click on a system name to see it or type below to filter the list in real time</div>
								<input type="text" id="listSearchKey">
								<div id="listGridParent">
								</div>
							</div>
							
							<div id="materialsGridParent" style="display:none;">
								<div class="paneltitle">Materials list</div>
								<div>click on a material button to check where you can find it in the hub</div>

								<div id="materialbuttonsgrid"><!--Buttons Here--></div>

								<div id="materialsListGridParent">
									<h3>Nothing to see here yet!</h3>
								</div>
							</div>
							
							<div id="findGridParent" style="display:none;">
							
								<div class="paneltitle">System sharing</div>
								<div>Input your system data to share to the community &amp; creator ;)</div>
								
								<form id="shareform">
								
									<label>Name of your system:</label>
									<input type="text" id="nameshare">
								
									<div grid>
										<div column>
											<label>What is the race on your system:</label>
											<select id="raceshare">
												<option value="0" selected>Gek</option>
												<option value="1">Korvax</option>
												<option value="2">Vy'keen</option>
											</select>
										</div>
										
										<div column>
											<label>Distance to the center:</label>
											<input type="text" id="distanceCenter">
										</div>
									</div>

									<label>Distance to known stars (input 3):</label>
									
									<table id="distancessharedtable">
										<tr><th>Star index</th><th>Distance</th></tr>
										<tr>
											<td>
												<select id="starindexsharedA">
													<option value="" selected >None</option>
												</select>
											</td>
											<td>
												<input type="text" id="stardistancesharedA">
											</td>
										</tr>
										<tr>
											<td>
												<select id="starindexsharedB">
													<option value="" selected >None</option>
												</select>
											</td>
											<td>
												<input type="text" id="stardistancesharedB">
											</td>
										</tr>
										<tr>
											<td>
												<select id="starindexsharedC">
													<option value="" selected >None</option>
												</select>
											</td>
											<td>
												<input type="text" id="stardistancesharedC">
											</td>
										</tr>
									</table>
								</form>

								<button onclick="regionHandler.calculateNewStar()">Calculate</button>
							</div>
							
							
						</div>
					</section>
					
				</div>
				<div column="8" id="rightpanel">
					<div id="canvasParent">
						<canvas id="canvas" ></canvas>
					</div>
				</div>
			</div>
		</div>
		
		<script id="selectstartemplate" type="text/template">
			{{#data}}
				<option value="solarIndex">{{getHexSolarId}}-{{name}}</option>
			{{/data}}
		</script>
		
		<script id="systemGridTemplate" type="text/template">
			<table id="systemGridTable">
				<tr><th>ID</th><th>Name</th><th>Color</th><th>Race</th></tr>
				{{#currentData}}
					<tr class="gridStarRow">
						<td>{{getHexSolarId}}</td>
						<td class="gridStarName" onclick="regionHandler.lookAt({{solarIndex}});">{{name}}</td>
						<td><div class="gridStarColor" style="background-color:rgb({{getStarColor}});"></div></td>
						<td>{{getRaceName}}</td>
					</tr>
				{{/currentData}}
			</table>
			<hr/>
			<div> Page {{humanPageIndex}} of {{maxPages}}   
				<i class="icon-left-open pageleft" title="previous" onclick="uiHandler.systemGrid.listPrevPage();"> Prev</i> 
				<i class="icon-right-open pageright" title="next" onclick="uiHandler.systemGrid.listNextPage();"> Next</i> 
			</div>
		</script>
		
		<script id="materialbuttonstemplate" type="text/template">
			{{#data}}
				<div column="6" class="materialbuttondiv"><button class="materialbutton">{{name}}</button></div>
			{{/data}}
		</script>
		
		
		<script id="tabletemplate" type="text/template">
			<table id="datatable">
				<tr><th>ID</th><th>Name</th><th>Color</th><th>Race</th></tr>
				{{#currentData}}
					<tr class="gridStarRow">
						<td>{{getHexSolarId}}</td>
						<td class="gridStarName" onclick="regionHandler.lookAt({{solarIndex}});">{{name}}</td>
						<td><div class="gridStarColor" style="background-color:rgb({{getStarColor}});"></div></td>
						<td>{{getRaceName}}</td>
					</tr>
				{{/currentData}}
			</table>
			<hr/>
			<div> Page {{humanPageIndex}} of {{maxPages}}   
				<i class="icon-left-open pageleft" title="previous" onclick="uiHandler.systemGrid.listPrevPage();"> Prev</i> 
				<i class="icon-right-open pageright" title="next" onclick="uiHandler.systemGrid.listNextPage();"> Next</i> 
			</div>
		</script>
	</body>
</html>
