$(".menuitem").click((function(){$(".menuitem").removeClass("active"),$(".page").removeClass("active"),$(this).addClass("active"),$("#"+$(this).attr("rel")).addClass("active")})),rivets.configure({templateDelimiters:["{{","}}"]}),rivets.formatters.plus=function(e,t){return e+t};var nms_platforms={PLAT_PS4:1,PLAT_PC:2},c=Phoria.Util.generateUnitCube(50),cubeParent=Phoria.Entity.create({points:c.points,edges:c.edges,polygons:c.polygons,style:{color:[238,238,238],drawmode:"wireframe"}});function Star(e,t,a,r,i,s,n,o,l){if(!(this instanceof Star))return new Star(e,t,a,r,i,s,n,o);this.regionId=e,this.solarIndex=t,this.x=r,this.y=i,this.z=s,this.starColorIndex=n,this.mapObject=void 0,this.metadata={race:o,name:a,systemTags:"",systemDescription:"",systemPage:""},l&&(this.metadata.systemTags=l.SystemTags,this.metadata.systemDescription=l.SystemDescription,this.metadata.systemPage=l.SystemPage),this.raceName=races[this.metadata.race],this.systemName=settingsPanelApp.current_platform==nms_platforms.PLAT_PS4?this.metadata.name.ps4:this.metadata.name.pc,this.hexSolarId=toHex(this.solarIndex,4),this.starColor=colors[this.starColorIndex],this.bgColor="background-color:rgb("+this.starColor+");",this.domNodeId="#sys_"+this.regionId+"_"+this.solarIndex,this.getPosArray=function(){return[this.x,this.y,this.z]},this.getPosVector=function(){return{x:this.x,y:this.y,z:this.z}}}var phoriaHandler={cameraAngleH:1.5708,cameraAngleV:1.5708,selectedItem:void 0,initialize:function(e,t){var a=document.getElementById(t),r=document.getElementById(e);r.width=.99*a.getBoundingClientRect().width;var i=$("#mainnav").height(),s=document.documentElement.clientHeight;r.height=.95*(s-i);var n=new Phoria.Scene;n.camera.position={x:0,y:5,z:-15},n.perspective.aspect=r.width/r.height,n.viewport.width=r.width,n.viewport.height=r.height,this.scene=n,this.renderer=new Phoria.CanvasRenderer(r),n.graph.push(new Phoria.DistantLight);var o=Phoria.Util.generateUnitCube(1),l=Phoria.Entity.create({points:o.points,edges:o.edges,polygons:o.polygons,style:{color:[255,0,0],drawmode:"wireframe"}});l.position=[8e3,8e3,8e3],l.translate(l.position),n.graph.push(l),this.selectBox=l,this.camera=this.scene.camera;var h=Phoria.View.addMouseEvents(r,(function(){Phoria.View.calculateClickPointAndVector(phoriaHandler.scene,h.clickPositionX,h.clickPositionY)}));this.generateStarField()},moveSelectBox:function(e){s=this.selectBox,s.translate([-s.position[0],-s.position[1],-s.position[2]]),s.translate(e),this.selectBox.position=e},resetCameraAngle:function(){drawPanelApp.horizontalAngle=90,drawPanelApp.verticalAngle=90,drawPanelApp.zoomValue=0,this.camera.unzoomedPosition={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z}},doUpDownCamera:function(e){this.camera.position.y+=e?10:-10,this.camera.lookat.y+=e?10:-10,this.renderFrame()},doZoom:function(e){var t=e?1:-1,a=this.camera.lookat.x-this.camera.position.x;a*=t;var r=this.camera.lookat.y-this.camera.position.y;r*=t;var i=this.camera.lookat.z-this.camera.position.z;i*=t,this.camera.position.x+=a/10,this.camera.position.y+=r/10,this.camera.position.z+=i/10,this.renderFrame()},doZoomBar:function(e){var t=e/100,a=this.camera.lookat.x-this.camera.unzoomedPosition.x;a*=t;var r=this.camera.lookat.y-this.camera.unzoomedPosition.y;r*=t;var i=this.camera.lookat.z-this.camera.unzoomedPosition.z;i*=t,this.camera.position.x=this.camera.unzoomedPosition.x+a,this.camera.position.y=this.camera.unzoomedPosition.y+r,this.camera.position.z=this.camera.unzoomedPosition.z+i,this.renderFrame()},rotateCamXZ:function(e){var t=.0174533*(e?1:-1),a=this.camera.lookat.x,r=this.camera.position.x,i=this.camera.lookat.z,s=this.camera.position.z,n=Math.sqrt(Math.pow(a-r,2)+Math.pow(i-s,2));this.cameraAngleH-=t,this.camera.position.x=a+Math.cos(this.cameraAngleH)*n,this.camera.position.z=i+Math.sin(this.cameraAngleH)*n,this.renderFrame()},rotateCamXZDegree:function(e){var t=.0174533*e,a=this.camera.lookat.x,r=this.camera.position.x,i=this.camera.lookat.z,s=this.camera.position.z,n=Math.sqrt(Math.pow(a-r,2)+Math.pow(i-s,2));this.cameraAngleH=t,this.camera.position.x=a+Math.cos(this.cameraAngleH)*n,this.camera.position.z=i+Math.sin(this.cameraAngleH)*n,this.renderFrame()},rotateCamYZ:function(e){var t=.0174533*(e?1:-1),a=this.camera.lookat.y,r=this.camera.position.y,i=this.camera.lookat.z,s=this.camera.position.z,n=Math.sqrt(Math.pow(a-r,2)+Math.pow(i-s,2));this.cameraAngleV-=t,this.camera.position.y=a+Math.cos(this.cameraAngleV)*n,this.camera.position.z=i+Math.sin(this.cameraAngleV)*n,this.renderFrame()},rotateCamYZDegree:function(e){var t=.0174533*e,a=this.camera.lookat.y,r=this.camera.position.y,i=this.camera.lookat.z,s=this.camera.position.z,n=Math.sqrt(Math.pow(a-r,2)+Math.pow(i-s,2));this.cameraAngleV=t,this.camera.position.y=a+Math.cos(this.cameraAngleV)*n,this.camera.position.z=i+Math.sin(this.cameraAngleV)*n,this.renderFrame()},renderFrame:function(){null!=this.scene&&(this.scene.modelView(),this.renderer.render(this.scene))},addToScene:function(e){null!=this.scene&&this.scene.graph.push(e)},generateStarField:function(){for(var e=5e3,t=(e=e||1)/2,a=[],r=0;r<500;r++)a.push({x:Math.random()*e-t,y:Math.random()*e-t,z:Math.random()*e-t});var i=Phoria.Entity.create({points:a,style:{color:[200+~~(55*Math.random()),200+~~(55*Math.random()),200+~~(55*Math.random())],drawmode:"point",shademode:"plain",linewidth:.5,linescale:200,objectsortmode:"back"}});i.matrix=null,this.scene.graph.push(i)},generateStar:function(e,t){var a=void 0;if(0==e.solarIndex){100,(r=[]).push({x:0,y:0,z:0}),a=Phoria.Entity.create({id:e.systemName,points:r,style:{color:e.starColor,drawmode:"point",shademode:"plain",linewidth:2,linescale:8e4,objectsortmode:"back"}}).translateX(e.x).translateY(e.y).translateZ(e.z)}else{var r;(r=[]).push({x:e.x,y:e.y,z:e.z}),a=Phoria.Entity.create({id:e.systemName,points:r,style:{color:e.starColor,drawmode:"point",shademode:"plain",linewidth:.5,linescale:50,objectsortmode:"back"}});var i=new Phoria.Entity;i.id=a.id,i.points=[{x:e.x,y:e.y,z:e.z}],i.style={drawmode:"point",shademode:"callback",geometrysortmode:"none",objectsortmode:"front"},i.config={},i.onRender((function(t,r,i){var s=phoriaHandler.camera.position.x,n=phoriaHandler.camera.position.y,o=phoriaHandler.camera.position.z,l=e.x,h=e.y,c=e.z;if(Math.sqrt(Math.pow(s-l,2)+Math.pow(n-h,2)+Math.pow(o-c,2))<50||regionHandler.selectedStar==e){t.fillStyle="#999999",t.font="14pt Helvetica";var p=i;p+=5,t.fillText(a.id?a.id:"unknown - set Entity 'id' property",r+5,p)}})),a.children.push(i)}return a}},regionHandler={initialize:function(){this.stars=[],this.mapObjects=[],this.selectedStar=void 0;var e=[new Star(1,0,{ps4:"Galaxy center",pc:"Galaxy center"},-145762.8716783917,.019204677335472303,-.00010293581164446534,0,0),new Star(1,292,{ps4:"CoolJungle",pc:"CoolJungle"},20825.72704688998,-19.202783753792243,-3.0805012641606018,3,2),new Star(1,436,{ps4:"LizardWorld",pc:"LizardWorld"},20818.927720684194,-12.418330391875925,8.679687637891412,3,2),new Star(1,2457,{ps4:"Hub",pc:"Hub"},20811.32748949516,-16.15057093374628,-5.244964575966744,1,0),new Star(1,254,{ps4:"Faith",pc:"Faith"},20826.327571536,-15.405985004529528,-4.635964087619606,3,1),new Star(1,383,{ps4:"SouthernLight",pc:"SouthernLight"},20797.12265919312,-43.269288425630926,2.8450806637888504,3,2),new Star(1,116,{ps4:"FistOfTheNorth",pc:"FistOfTheNorth"},20838.417260783983,60.512951161021306,-3.449881518159776,0,1),new Star(1,121,{ps4:"BlackHole",pc:"BlackHole"},20845.021929809347,45.91480267460992,4.886646137508365,0,2)];this.regionCenter={x:e[3].x,y:e[3].y,z:e[3].z};for(var t=0;t<e.length;t++)this.addStar(e[t]);var a=this.stars[0],r=this.stars[3];a.x,a.y,a.z,r.x,r.y,r.z;null!=phoriaHandler.scene&&(phoriaHandler.camera.lookat={x:e[3].x,y:e[3].y,z:e[3].z},phoriaHandler.camera.position={x:e[3].x,y:e[3].y,z:e[3].z+220},phoriaHandler.moveSelectBox(e[3].getPosArray()),phoriaHandler.camera.position={x:9999,y:9999,z:9999},phoriaHandler.camera.lookat={x:0,y:0,z:0}),phoriaHandler.scene.graph.push(cubeParent)},getStarByIndex:function(e){for(var t=0;t<this.stars.length;t++)if(this.stars[t].solarIndex==e)return this.stars[t];return null},getDistance:function(e,t){var a=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(a*a+r*r+i*i)},addStar:function(e){e.x-=this.regionCenter.x,e.y-=this.regionCenter.y,e.z-=this.regionCenter.z;var t=phoriaHandler.generateStar(e,void 0);e.mapObject=t,cubeParent.children.push(t),this.stars.push(e)},addPseudoStar:function(e,t,a,r,i,s,n,o){for(var l=s,h=n,c=[],p=0;p<l.length;p++){if(0==l[p].length)return;var m=0,d=1;if("0"!=l[p].trim()){var g=l[p].split("_");m=parseInt(g[0],16),d=Number(g[1])}else m=0,d=1;l[p]=m,h[p]=Number(h[p]),h[p]<1e5&&(h[p]/=4);for(var u=0;u<this.stars.length;u++)if(this.stars[u].solarIndex==m&&this.stars[u].regionId==d){var y=this.stars[u];c.push({x:y.x,y:y.y,z:y.z,r:h[p]});break}}if(c.length==l.length){var v=trilaterate(c[0],c[1],c[2]),f=trilaterate(c[0],c[2],c[3]),x=trilaterate(c[1],c[2],c[3]),P=trilaterate(c[0],c[1],c[3]),w=[];null!=v&&v.forEach((function(e){w.push(e)})),null!=f&&f.forEach((function(e){w.push(e)})),null!=x&&x.forEach((function(e){w.push(e)})),null!=P&&P.forEach((function(e){w.push(e)})),w.forEach((function(e){e.error1=Math.abs(regionHandler.getDistance(e,regionHandler.getStarByIndex(l[0]))-h[0]),e.error2=Math.abs(4*regionHandler.getDistance(e,regionHandler.getStarByIndex(l[1]))-4*h[1]),e.error3=Math.abs(4*regionHandler.getDistance(e,regionHandler.getStarByIndex(l[2]))-4*h[2]),e.error4=Math.abs(4*regionHandler.getDistance(e,regionHandler.getStarByIndex(l[3]))-4*h[3]),e.errormean=(e.error1+e.error2+e.error3+e.error4)/4})),w.sort((function(e,t){return e.errormean<t.errormean?-1:1}));p=0;w.forEach((function(s){0==p&&regionHandler.addStar(new Star(e,t,a,s.x+20811.32748949516,s.y-16.15057093374628,s.z-5.244964575966744,r,i,o)),p++}))}else console.log("Cannot add: ",a,"with",s,n,"Not All ids found")},updateLabels:function(e,t){for(var a=0;a<this.stars.length;a++){var r=" ";switch(e){case 0:r=" ";break;case 1:r=this.stars[a].systemName;break;case 2:r=this.stars[a].hexSolarId;break;case 3:r=this.stars[a].hexSolarId+" - "+this.stars[a].systemName}t<=0&&(t=9999),this.stars[a]!=regionHandler.selectedStar?this.stars[a].mapObject.id=r.substr(0,t):this.stars[a].mapObject.id=r}phoriaHandler.renderFrame()},lookAt:function(e,t){if(t=Number(t),!isNaN(t)){for(var a=0;a<this.stars.length;a++)if(this.stars[a].solarIndex==t&&this.stars[a].regionId==e){var r=this.stars[a];this.selectedStar=r,phoriaHandler.camera.lookat={x:r.x,y:r.y,z:r.z},phoriaHandler.camera.position={x:r.x,y:r.y,z:r.z+220},phoriaHandler.moveSelectBox(r.getPosArray()),phoriaHandler.resetCameraAngle();break}phoriaHandler.renderFrame()}}},settingsPanelApp={viewActive:!1,isTab:!0,current_platform:nms_platforms.PLAT_PS4,items_per_page:5,max_name_length:0,changeCallbacks:[],runCallbacks:function(){for(var e=settingsPanelApp,t=0;t<e.changeCallbacks.length;t++)e.changeCallbacks[t]()},applySettings:function(){settingsPanelApp.runCallbacks()}},settingsPanelAppBind=rivets.bind($("#settingsPanelApp")[0],settingsPanelApp),systemSelectionApp={viewActive:!0,isTab:!0,systemFilter:"",visibleSystems:[],currentPage:0,maxPages:1,maxPerPage:settingsPanelApp.items_per_page,pagesAvailable:!1,wikiLoading:!1,maxPerPageChange:function(){var e=systemSelectionApp;e.currentPage=0,e.maxPerPage=Number(settingsPanelApp.items_per_page),e.refreshSystems()},prevPage:function(){var e=systemSelectionApp;e.currentPage>0&&e.currentPage--,e.refreshSystems()},nextPage:function(){var e=systemSelectionApp;e.currentPage<e.maxPages-1&&e.currentPage++,e.refreshSystems()},dynamicSort:function(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(a,r){return(a[e]<r[e]?-1:a[e]>r[e]?1:0)*t}},sortById:function(e){var t=systemSelectionApp;t.privateData=t.privateData.sort(t.dynamicSort(e))},applyFilter:function(){var e=systemSelectionApp;e.currentPage=0;for(var t=regionHandler.stars.slice(),a=e.systemFilter.toLowerCase(),r=[],i=0;i<t.length;i++)(t[i].systemName.toLowerCase().includes(a)||t[i].hexSolarId.toLowerCase().includes(a)||"race:"+t[i].raceName.toLowerCase()[0]==a||"color:"+systemColors[t[i].starColorIndex]==a)&&r.push(t[i]);e.privateData=r,e.sortById("solarIndex"),e.refreshSystems()},refreshSystems:function(){var e=systemSelectionApp;e.maxPages=Math.ceil(e.privateData.length/e.maxPerPage),e.pagesAvailable=0!=e.maxPages,e.visibleSystems=e.privateData.slice(e.currentPage*e.maxPerPage,e.currentPage*e.maxPerPage+e.maxPerPage)},showSystem:function(e){var t="#sys_";if(e.target.id.indexOf(!0)){var a=e.target.id.replace(t,"").split("_"),r=Number(a[0]),i=Number(a[1]);regionHandler.lookAt(r,i)}},privateData:[]};settingsPanelApp.changeCallbacks.push(systemSelectionApp.maxPerPageChange),$("#systemFilterTexBox").keyup((function(e){systemSelectionApp.applyFilter()}));var uiSelectionApp={isTab:!0,viewSystemList:!0,viewMaterials:!1,viewSettings:!1,systemSelectionApp:systemSelectionApp,viewChangeCallbacks:Array(),runCallbacks:function(){for(var e=0;e<this.viewChangeCallbacks.length;e++)this.viewChangeCallbacks[e]();systemSelectionApp.viewActive=this.viewSystemList,materialSelectionApp.viewActive=this.viewMaterials,settingsPanelApp.viewActive=this.viewSettings},showSystemList:function(){this.viewSystemList=!0,this.viewMaterials=!1,this.viewSettings=!1,this.runCallbacks()},showMaterials:function(){this.viewSystemList=!1,this.viewMaterials=!0,this.viewSettings=!1,this.runCallbacks()},showSettings:function(){this.viewSystemList=!1,this.viewMaterials=!1,this.viewSettings=!0,this.runCallbacks()}},uiSelectionAppBind=rivets.bind($("#systemSelectionApp")[0],uiSelectionApp),drawPanelApp={horizontalAngle:90,verticalAngle:90,zoomValue:0,labelType:1,updateCameraRotationH:function(){var e=drawPanelApp;phoriaHandler.rotateCamXZDegree(e.horizontalAngle)},updateCameraRotationV:function(){var e=drawPanelApp;phoriaHandler.rotateCamYZDegree(e.verticalAngle)},updateZoom:function(){var e=drawPanelApp;phoriaHandler.doZoomBar(e.zoomValue)},updateLabels:function(){var e=drawPanelApp;regionHandler.updateLabels(Number(e.labelType),settingsPanelApp.max_name_length)}};settingsPanelApp.changeCallbacks.push(drawPanelApp.updateLabels);var drawPanelAppBind=rivets.bind($("#drawPanelApp")[0],drawPanelApp);
